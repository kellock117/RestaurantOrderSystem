<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<style>
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
    }
    
    table {
    width: 100%;
    border: 1px solid #444444;
    border-collapse: collapse;
    }
    
    th, td {
        border: 1px solid #444444;
    }

    .topnav {
      overflow: hidden;
      background-color: #333;
    }
    
    .topnav a {
      float: left;
      color: #f2f2f2;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
      font-size: 17px;
    }
    
    .topnav a:hover {
      background-color: #ddd;
      color: black;
    }
    
    .topnav a.active {
      background-color: #04AA6D;
      color: white;
    }
    </style>
<body>
    <h1>Staff Main</h1>
        <div class="topnav">
            <a id = "vieworder">View Orders</a>
            <a id = "searchorder">Search Orders</a>
            <a id = "logout">Logout</a>
          </div>
          <div>
            <!-- view order -->
            <div id = "pg0" style="display: none">
                <table id="view orderList">
                    <tr>
                        <th>Table Number</th><th>Menus</th><th>Total Amount</th><th>Confirm Order</th><th>Reject Order</th>
                    </tr>
                </table>
            </div>

            <!-- search order -->
            <div id="pg1" style="display: none">
                <div class="filter">
                    <select id="filter">
                        <option value="role">Role</option>
                        <option value="orderName">Order Name</option>
                    </select>
                    <input type="text" id="search value" placeholder="Enter value"/>
                    <button onclick="SearchOrder()">Search</button>
                </div>
                <table id="search orderList">
                    <tr>
                        <th>ID</th><th>PASSWORD</th><th>USER NAME</th><th>ROLE</th>
                    </tr>
                </table>
            </div>

    <script>
        let info = null        
        let viewLength = 0
        let searchLength = 0

        function ChangeEffect(func) {
            const navInfo = ["vieworder", "searchorder"]
            document.getElementById(func).className = "active"
            
            for (const e in navInfo) {
                if (navInfo[e] == func) {
                    document.getElementById(`pg${e}`).style.display = "block"
                    continue
                }
                document.getElementById(navInfo[e]).className = " "
                document.getElementById(`pg${e}`).style.display = "none"
            }
        }

        function RefreshViewTable() {
            const table = document.getElementById("view orderList")
            for (let i = 0; i < viewLength; i++) {
                table.deleteRow(-1)
            }
        }

        document.getElementById("vieworder").addEventListener("click", function(){
            RefreshViewTable()
            ChangeEffect("vieworder")

            fetch("http://localhost:5000/staff/viewOrder", {
            method: "GET",
            })
            .then((response) => response.json())
            .then((data) => {
                info = data
                ViewOrder()
            })
        } )

        document.getElementById("searchorder").addEventListener("click", function() {
            const table = document.getElementById("search orderList")
            for (let i = 0; i < searchLength; i++) {
                table.deleteRow(-1)
            }
            ChangeEffect("searchorder")
        } )

        document.getElementById("logout").addEventListener("click", function() {
            fetch("htt[://localhost:5000/staff/logout", {
                method: "get"
            })
            location.replace("http://localhost:5000/")
        } )

        function ViewOrder() {
            const table = document.getElementById("view orderList")

            for (const element of info) {
                const row = table.insertRow()
                row.id = element._id

                const tableNumberCell = row.insertCell()
                tableNumberCell.innerText = element.tableNumber

                const menusCell = row.insertCell()
                let value = ""
                for (const menu of element.menus) {
                    value += JSON.stringify(menu)
                }
                menusCell.innerText = value

                const totalAmountCell = row.insertCell()
                totalAmountCell.innerText = element.totalAmount

                const confirmCell = row.insertCell()
                confirmCell.innerHTML = `<button onClick="ConfirmOrder(${element._id})">Confirm</button>`
                
                const deleteCell = row.insertCell()
                deleteCell.innerHTML = `<button onClick="DeleteOrder(${element._id})">Delete</button>`
            }

            viewLength = info.length
        }

        function ConfirmOrder(id) {
            fetch("http://localhost:5000/staff/confrimOrder", {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    _id: id
                })
            })
            .then((response) => response.json())
            .then((data) => {
                if (data.status === 'success') {
                    window.alert("Confirmed")
                    RefreshViewTable()
                }
                else {
                    window.alert("fail to confrim")
                }
            })
        }

        function DeleteOrder(id) {
            fetch("http://localhost:5000/staff/deleteOrder", {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    _id: id
                })
            })
            .then((response) => response.json())
            .then((data) => {
                if (data.status === 'success') {
                    window.alert("Deleted")
                    RefreshViewTable()
                }
                else {
                    window.alert("fail to delete")
                }
            })
        }

        function SearchOrder() {
            const infoList = ["id", "password", "orderName", "role"]
            const table = document.getElementById("search orderList")
            const filter = document.getElementById("filter").value
            const value = document.getElementById("search value").value

            if (value == "" ) {
                window.alert("Please fill in the blank")
                return
            }

            fetch("http://localhost:5000/admin/search", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    filter: filter,
                    value: value
                })
            })
            .then((response) => response.json())
            .then((data) => {
                for (const element of data) {
                    const row = table.insertRow()

                    for (const e of infoList) {
                        const cell = row.insertCell()
                        cell.innerText = element[e]
                    }
                }

                searchLength = data.length
            })
        }
    </script>
</body>
</html>
